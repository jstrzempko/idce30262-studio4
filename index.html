<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Studio Week 4</title>
  <!-- Adding in the Leaflet CSS file -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" />
  <!-- Adding in the Leaflet MarkerCluster CSS file -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.3.0/dist/MarkerCluster.css" />
  <!-- Adding Leaflet JavaScript markercluster file -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.3.0/dist/MarkerCluster.Default.css" />
  <!-- Adding Leaflet JavaScript file -->
  <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
  <!-- Adding Leaflet JavaScript jquery file -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <!-- Adding Leaflet markercluster JavaScript file-->
  <script src="https://unpkg.com/leaflet.markercluster@1.3.0/dist/leaflet.markercluster.js"></script>
  <!-- Adding Leaflet Heatmap functionality-->
  <script src="./leaflet-heat.js"></script>

  <!-- Add CSS styling info for the map -->
  <style type="text/css">
    #map {
      border-radius: 10px;
      height: 600px;
    }
    #maptwo {
      border-radius: 10px;
      height: 600px;
    }
  </style>
  <!-- Adding styling info for page layout by reading in a CSS file -->
  <link rel="stylesheet" href="css/styles.css">

</head>

<body>
  <div>
    <h1 style="text-align: center;">Studio Week 4</h1>
  </div>
  <div>
    <h2 style="text-align: center;">Rat Map</h2>
  </div>
  <!-- Add multiple pages to web page-->
  <!-- active class displays the grey box around current page-->
  <ul>
    <li style="text-align: center;"><a class="active" href="index.html" target="_self">Output 1</a>
      <a href="googlesheet.html" target="_self">Output 2</a>
      <a href="adventure.html" target="_self">Output 3</a>
    </li>
  </ul>
  <br>

  <!-- Add a div to give the map somewhere to go -->
  <div id='map'></div>

  <p></p>

  <div id='maptwo'></div>

  <script>
    // initialize the map
    var map = L.map('map').setView([42.35, -71.08], 13);

    // load a tile layer
    L.tileLayer('https://{s}.tile.thunderforest.com/pioneer/{z}/{x}/{y}.png?apikey={apikey}', {
      attribution: '&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
      apikey: 'd3013c66d08a49b883009ce84981feef'
    }).addTo(map);

    attribution: '&copy; <a href="https://stadiamaps.com/">Stadia Maps</a>, &copy; <a href="https://openmaptiles.org/">OpenMapTiles</a> &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'

    // bike lanes
    //L.tileLayer('http://tiles.mapc.org/trailmap-onroad/{z}/{x}/{y}.png', {
    //  maxZoom: 17,
    //  minZoom: 9,
    //}).addTo(map);

    // load GeoJSON from an external file
    //$.getJSON('rodents.geojson', function (data) {
    // add GeoJSON layer to the map once the file is loaded
    //  L.geoJson(data).addTo(map);
    //});

    //$.getJSON('rodents.geojson', function(data) {
    //  var ratIcon = L.icon({
    //    iconUrl: 'rat.gif',
    //    iconSize: [50, 40],
    //  });
    //  L.geoJson(data, {
    //    pointToLayer: function(feature, latlng) {
    //      return L.marker(latlng, {
    //        icon: ratIcon,
    //      });
    //    }
    //  }).addTo(map);
    //});

    //$.getJSON('neighborhoods.geojson', function(hoodData) {
    //  L.geoJson(hoodData, {
    //    style: function(feature) {
    //      var fillColor,
    //        density = feature.properties.density;
    //      if (density > 80) fillColor = '#006837';
    //      else if (density > 40) fillColor = '#31a354';
    //      else if (density > 20) fillColor = '#78c679';
    //      else if (density > 10) fillColor = '#c2e699';
    //      else if (density > 0) fillColor = '#ffffcc';
    //      else fillColor = '#f7f7f7'; // no data
    //      return {
    //        color: '#999',
    //        weight: 1,
    //        fillColor: fillColor,
    //        fillOpacity: .6,
    //      };
    //    },

    //    onEachFeature: function(feature, layer) {
    //      layer.bindPopup('<strong>' + feature.properties.Name + '</strong><br/>' + feature.properties.density + ' rats per square mile');
    //    }
    //  }).addTo(map);
    //});

    //$.getJSON('rodents.geojson', function(data) {
    //  var ratIcon = L.icon({
    //    iconUrl: 'rat.png',
    //    iconSize: [60, 50],
    //  });
    //  var rodents = L.geoJson(data, {
    //    pointToLayer: function(feature, latlng) {
    //      var marker = L.marker(latlng, {
    //        icon: ratIcon,
    //      });
    //      marker.bindPopup(feature.properties.Location + '<br/>' + feature.properties.OPEN_DT);
    //      return marker;
    //    }
    //  });

    //  var clusters = L.markerClusterGroup();
    //  clusters.addLayer(rodents);
    //  map.addLayer(clusters);
    //});

    map.setZoom(12);
    $.getJSON('rodents.geojson', function(data) {
      var locations = data.features.map(function(rat) {
        // the heatmap plugin wants an array of each location
        var location = rat.geometry.coordinates.reverse();
        location.push(0.5);
        return location; // e.g. [50.5, 30.5, 0.2], // lat, lng, intensity
      });

      var heat = L.heatLayer(locations, {
        radius: 25,
      });
      map.addLayer(heat);
    });

    // initialize the map
    var maptwo = L.map('maptwo').setView([42.35, -71.08], 13);

    // load a tile layer
    L.tileLayer('https://{s}.tile.thunderforest.com/pioneer/{z}/{x}/{y}.png?apikey={apikey}', {
      attribution: '&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
      apikey: 'd3013c66d08a49b883009ce84981feef'
    }).addTo(maptwo)

    $.getJSON('neighborhoods.geojson', function(hoodData) {
      L.geoJson(hoodData, {
        style: function(feature) {
          var fillColor,
            density = feature.properties.density;
          if (density > 80) fillColor = '#320000';
          else if (density > 40) fillColor = '#600817';
          else if (density > 20) fillColor = '#921625';
          else if (density > 10) fillColor = '#c82731';
          else if (density > 0) fillColor = '#ff3b3b';
          else fillColor = '#f7f7f7'; // no data
          return {
            color: '#f7f7f7',
            weight: 1,
            fillColor: fillColor,
            fillOpacity: .6,
          };
        },


        onEachFeature: function(feature, layer) {
          layer.bindPopup('<strong>' + feature.properties.Name + '</strong><br/>' + feature.properties.density + ' rats per square mile');
        }
      }).addTo(maptwo);
    });

    $.getJSON('rodents.geojson', function (data) {
      var ratIcon = L.icon({
        iconUrl: 'rat.png',
        iconSize: [60, 50],
      });
      var rodents = L.geoJson(data, {
        pointToLayer: function (feature, latlng) {
          var marker = L.marker(latlng, {
            icon: ratIcon,
          });
          marker.bindPopup(feature.properties.Location + '<br/>' + feature.properties.OPEN_DT);
          return marker;
        }
      });

      var clusters = L.markerClusterGroup();
      clusters.addLayer(rodents);
      map.addLayer(clusters);
    });

  </script>
</body>

</html>
